<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Carteirinha Estudantil</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      background: #f5f5f5;
    }

    input {
      padding: 10px;
      font-size: 16px;
      width: 220px;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      cursor: pointer;
    }

    canvas {
      width: 100%;
      max-width: 800px;
      margin: 20px auto;
      display: block;
      background: #ddd;
      border-radius: 10px;
    }
    
    .info {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      padding: 15px;
      margin: 20px auto;
      max-width: 800px;
      border-radius: 5px;
      color: #856404;
    }
  </style>
</head>

<body>

<h2>Carteirinha Estudantil</h2>

<div class="info">
  <strong>Para testar:</strong><br>
  • CPF: <code>12345678909</code> (Aluno Teste)<br>
  • CPF: <code>98765432100</code> (Estelionatária Souza)<br>
  • Ou digite qualquer CPF para testar
</div>

<input type="text" id="cpf" placeholder="Digite seu CPF">
<br>
<button onclick="verificar()">Acessar</button>

<!-- FRENTE -->
<canvas id="frente" width="800" height="500"></canvas>

<!-- VERSO -->
<canvas id="verso" width="800" height="500"></canvas>

<!-- Bibliotecas -->
<script src="https://cdn.jsdelivr.net/npm/js-sha256"></script>

<script>
/* ==========================
   DADOS DOS ALUNOS (EMBEDDED)
========================== */
const alunos = [
  {
    hash: "a8476735b37a541a38402a2e7037c79e2d217fe9780e5e34347156ef61eff42b",
    nome: "Aluno Teste",
    instituicao: "Estácio",
    curso: "Ensino Médio",
    matricula: "0001",
    cidade: "Anadia",
    turno: "Noturno",
    validade: "12/12/2026"
  },
  {
    hash: "4914e1b9960e6236dfaacbad1b30c7996074fe980c6d9ea49bb87f65a6fb14ef",
    nome: "Estelionatária Souza",
    instituicao: "Ifal",
    curso: "Letras",
    matricula: "0002",
    cidade: "Anadia",
    turno: "Matutino",
    validade: "12/12/2026"
  }
];

/* ==========================
   CONFIGURAÇÃO PARA GITHUB PAGES
========================== */
// Se o seu repositório é username.github.io/repo-name, use:
const BASE_URL = window.location.pathname.includes('/') 
  ? window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1)
  : './';

const CONFIG = {
  caminhoImagens: BASE_URL + "imagens/",
  caminhoFotos: BASE_URL + "imagens/fotos/"
};

console.log("Base URL:", BASE_URL);
console.log("Caminho imagens:", CONFIG.caminhoImagens);

/* ==========================
   CANVAS
========================== */
const canvasFrente = document.getElementById("frente");
const ctxFrente = canvasFrente.getContext("2d");

const canvasVerso = document.getElementById("verso");
const ctxVerso = canvasVerso.getContext("2d");

/* ==========================
   LIMPAR
========================== */
function limpar() {
  ctxFrente.clearRect(0, 0, canvasFrente.width, canvasFrente.height);
  ctxVerso.clearRect(0, 0, canvasVerso.width, canvasVerso.height);
}

/* ==========================
   FUNÇÃO PRINCIPAL
========================== */
function verificar() {
  const cpf = document.getElementById("cpf").value.replace(/\D/g, '');
  
  if (!cpf) {
    alert("Por favor, digite um CPF!");
    return;
  }
  
  const hash = sha256(cpf);
  const aluno = alunos.find(a => a.hash === hash);

  limpar();

  if (!aluno) {
    ctxFrente.font = "20px Arial";
    ctxFrente.fillStyle = "red";
    ctxFrente.fillText("Aluno não encontrado", 280, 250);
    return;
  }

  desenharFrente(aluno);
  desenharVerso();
}

/* ==========================
   FUNÇÃO AUXILIAR PARA TEXTOS
========================== */
function desenharTextos(aluno) {
  ctxFrente.fillStyle = "#000";

  ctxFrente.font = "bold 28px Arial";
  ctxFrente.fillText(aluno.nome, 350, 130);

  ctxFrente.font = "24px Arial";
  ctxFrente.fillText(aluno.instituicao, 450, 190);
  ctxFrente.fillText(aluno.curso, 450, 245);
  ctxFrente.fillText(aluno.cidade, 450, 300);
  ctxFrente.fillText(aluno.turno, 450, 357);
  ctxFrente.fillText(aluno.validade, 450, 420);

  // MATRÍCULA VERTICAL
  ctxFrente.save();
  ctxFrente.translate(82, 320);
  ctxFrente.rotate(-Math.PI / 2);
  ctxFrente.font = "24px Arial";
  ctxFrente.fillText(aluno.matricula, 0, 0);
  ctxFrente.restore();
}

/* ==========================
   FUNÇÃO PARA CARREGAR IMAGEM COM FALLBACK
========================== */
function carregarImagem(url, fallbackUrl = null) {
  return new Promise((resolve, reject) => {
    const img = new Image();
    img.onload = () => resolve(img);
    img.onerror = () => {
      if (fallbackUrl) {
        const fallbackImg = new Image();
        fallbackImg.onload = () => resolve(fallbackImg);
        fallbackImg.onerror = () => reject(`Não foi possível carregar ${url} nem fallback`);
        fallbackImg.src = fallbackUrl;
      } else {
        reject(`Não foi possível carregar ${url}`);
      }
    };
    img.src = url;
  });
}

/* ==========================
   FRENTE - MODIFICADA
========================== */
async function desenharFrente(aluno) {
  try {
    // Tenta carregar o fundo
    const urlFundo = CONFIG.caminhoImagens + "modelo-frente.png";
    const urlFoto = CONFIG.caminhoFotos + aluno.matricula + ".jpg";
    
    // Fallback para GitHub Pages - imagem placeholder
    const fallbackFundo = "https://via.placeholder.com/800x500/4a6fa5/ffffff?text=CARTEIRINHA+ESTUDANTIL";
    const fallbackFoto = `https://i.pravatar.cc/300?img=${parseInt(aluno.matricula)}`;
    
    // Carrega fundo (com fallback)
    const fundo = await carregarImagem(urlFundo, fallbackFundo);
    ctxFrente.drawImage(fundo, 0, 0, canvasFrente.width, canvasFrente.height);
    
    // Carrega foto (com fallback)
    try {
      const foto = await carregarImagem(urlFoto, fallbackFoto);
      ctxFrente.drawImage(foto, 125, 195, 160, 180);
    } catch (fotoError) {
      console.warn("Usando fallback para foto:", fotoError);
      ctxFrente.fillStyle = "#ccc";
      ctxFrente.fillRect(125, 195, 160, 180);
      ctxFrente.fillStyle = "#666";
      ctxFrente.font = "16px Arial";
      ctxFrente.fillText("Foto", 185, 285);
    }
    
    // Desenha textos
    desenharTextos(aluno);
    
  } catch (error) {
    console.error("Erro ao desenhar frente:", error);
    // Desenha uma versão básica mesmo sem imagens
    ctxFrente.fillStyle = "#4a6fa5";
    ctxFrente.fillRect(0, 0, canvasFrente.width, canvasFrente.height);
    
    ctxFrente.fillStyle = "#fff";
    ctxFrente.font = "bold 32px Arial";
    ctxFrente.fillText("CARTEIRINHA ESTUDANTIL", 180, 80);
    
    // Área da foto
    ctxFrente.fillStyle = "#fff";
    ctxFrente.fillRect(120, 140, 170, 200);
    ctxFrente.fillStyle = "#ccc";
    ctxFrente.fillRect(125, 145, 160, 190);
    
    // Desenha dados básicos
    desenharTextos(aluno);
  }
}

/* ==========================
   VERSO - MODIFICADA
========================== */
async function desenharVerso() {
  try {
    const urlFundo = CONFIG.caminhoImagens + "modelo-verso.png";
    const fallbackFundo = "https://via.placeholder.com/800x500/2c3e50/ffffff?text=VERSO+DA+CARTEIRINHA";
    
    const fundo = await carregarImagem(urlFundo, fallbackFundo);
    ctxVerso.drawImage(fundo, 0, 0, canvasVerso.width, canvasVerso.height);
    
  } catch (error) {
    console.error("Erro ao desenhar verso:", error);
    // Desenha um verso básico
    ctxVerso.fillStyle = "#2c3e50";
    ctxVerso.fillRect(0, 0, canvasVerso.width, canvasVerso.height);
    
    ctxVerso.fillStyle = "#fff";
    ctxVerso.font = "bold 28px Arial";
    ctxVerso.fillText("VERSO DA CARTEIRINHA", 220, 150);
    
    ctxVerso.font = "18px Arial";
    ctxVerso.fillText("Instituição: " + (alunos[0]?.instituicao || "Educacional"), 100, 220);
    ctxVerso.fillText("Validade: 12/12/2026", 100, 260);
    ctxVerso.fillText("Documento válido em todo território nacional", 100, 300);
  }
}

// Inicialização
console.log("Sistema carregado para GitHub Pages!");
console.log("URL Base:", BASE_URL);
</script>

</body>
</html>
