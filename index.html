<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Carteirinha Estudantil</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      background: #f5f5f5;
    }

    input {
      padding: 10px;
      font-size: 16px;
      width: 220px;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      cursor: pointer;
    }

    canvas {
      width: 100%;
      max-width: 800px;
      margin: 20px auto;
      display: block;
      background: #ddd;
      border-radius: 10px;
    }
    
    .info {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      padding: 15px;
      margin: 20px auto;
      max-width: 800px;
      border-radius: 5px;
      color: #856404;
    }
  </style>
</head>

<body>

<h2>Carteirinha Estudantil</h2>

<div class="info">
  <strong>Para testar:</strong><br>
  • CPF: <code>12345678909</code> (Aluno Teste)<br>
  • CPF: <code>98765432100</code> (Estelionatária Souza)<br>
  • Ou digite qualquer CPF para testar
</div>

<input type="text" id="cpf" placeholder="Digite seu CPF">
<br>
<button onclick="verificar()">Acessar</button>

<!-- FRENTE -->
<canvas id="frente" width="800" height="500"></canvas>

<!-- VERSO -->
<canvas id="verso" width="800" height="500"></canvas>

<!-- Bibliotecas -->
<script src="https://cdn.jsdelivr.net/npm/js-sha256"></script>

<script>
/* ==========================
   DADOS DOS ALUNOS (EMBEDDED)
========================== */
const alunos = [
  {
    hash: "a8476735b37a541a38402a2e7037c79e2d217fe9780e5e34347156ef61eff42b",
    nome: "Aluno Teste",
    instituicao: "Estácio",
    curso: "Ensino Médio",
    matricula: "0001",
    cidade: "Anadia",
    turno: "Noturno",
    validade: "12/12/2026"
  },
  {
    hash: "4914e1b9960e6236dfaacbad1b30c7996074fe980c6d9ea49bb87f65a6fb14ef",
    nome: "Estelionatária Souza",
    instituicao: "Ifal",
    curso: "Letras",
    matricula: "0002",
    cidade: "Anadia",
    turno: "Matutino",
    validez: "12/12/2026"
  }
];

/* ==========================
   CONFIGURAÇÃO CORRETA PARA SEU REPOSITÓRIO
========================== */
// CORRIJA AQUI: Use "Imagens" com I maiúsculo
const CONFIG = {
  caminhoImagens: "./Imagens/",  // Note o I maiúsculo
  caminhoFotos: "./Imagens/fotos/"  // Note o I maiúsculo
};

console.log("Configuração atual:", CONFIG);

/* ==========================
   CANVAS
========================== */
const canvasFrente = document.getElementById("frente");
const ctxFrente = canvasFrente.getContext("2d");

const canvasVerso = document.getElementById("verso");
const ctxVerso = canvasVerso.getContext("2d");

/* ==========================
   LIMPAR
========================== */
function limpar() {
  ctxFrente.clearRect(0, 0, canvasFrente.width, canvasFrente.height);
  ctxVerso.clearRect(0, 0, canvasVerso.width, canvasVerso.height);
}

/* ==========================
   FUNÇÃO PRINCIPAL
========================== */
function verificar() {
  const cpf = document.getElementById("cpf").value.replace(/\D/g, '');
  
  if (!cpf) {
    alert("Por favor, digite um CPF!");
    return;
  }
  
  const hash = sha256(cpf);
  const aluno = alunos.find(a => a.hash === hash);

  limpar();

  if (!aluno) {
    ctxFrente.font = "20px Arial";
    ctxFrente.fillStyle = "red";
    ctxFrente.fillText("Aluno não encontrado", 280, 250);
    ctxFrente.font = "14px Arial";
    ctxFrente.fillText(`Hash: ${hash.substring(0, 30)}...`, 200, 300);
    return;
  }

  console.log("Aluno encontrado:", aluno);
  console.log("Tentando carregar imagens de:", CONFIG.caminhoImagens);
  
  desenharFrente(aluno);
  desenharVerso();
}

/* ==========================
   FUNÇÃO AUXILIAR PARA TEXTOS
========================== */
function desenharTextos(aluno) {
  ctxFrente.fillStyle = "#000";

  ctxFrente.font = "bold 28px Arial";
  ctxFrente.fillText(aluno.nome, 350, 130);

  ctxFrente.font = "24px Arial";
  ctxFrente.fillText(aluno.instituicao, 450, 190);
  ctxFrente.fillText(aluno.curso, 450, 245);
  ctxFrente.fillText(aluno.cidade, 450, 300);
  ctxFrente.fillText(aluno.turno, 450, 357);
  ctxFrente.fillText(aluno.validade || aluno.validez, 450, 420);

  // MATRÍCULA VERTICAL
  ctxFrente.save();
  ctxFrente.translate(82, 320);
  ctxFrente.rotate(-Math.PI / 2);
  ctxFrente.font = "24px Arial";
  ctxFrente.fillText(aluno.matricula, 0, 0);
  ctxFrente.restore();
}

/* ==========================
   FRENTE - VERSÃO SIMPLIFICADA
========================== */
function desenharFrente(aluno) {
  const fundo = new Image();
  const foto = new Image();
  
  // URLs CORRETAS com I maiúsculo
  const urlFundo = CONFIG.caminhoImagens + "modelo-frente.png";
  const urlFoto = CONFIG.caminhoFotos + aluno.matricula + ".jpg";
  
  console.log("Carregando fundo:", urlFundo);
  console.log("Carregando foto:", urlFoto);
  
  fundo.onload = function() {
    console.log("✅ Fundo carregado com sucesso!");
    ctxFrente.drawImage(fundo, 0, 0, canvasFrente.width, canvasFrente.height);
    
    foto.onload = function() {
      console.log("✅ Foto carregada com sucesso!");
      ctxFrente.drawImage(foto, 125, 195, 160, 180);
      desenharTextos(aluno);
    };
    
    foto.onerror = function() {
      console.error("❌ Erro ao carregar foto:", urlFoto);
      ctxFrente.fillStyle = "#ccc";
      ctxFrente.fillRect(125, 195, 160, 180);
      ctxFrente.fillStyle = "#666";
      ctxFrente.font = "16px Arial";
      ctxFrente.fillText("Foto", 185, 280);
      ctxFrente.fillText(aluno.matricula, 175, 310);
      desenharTextos(aluno);
    };
    
    foto.src = urlFoto;
  };
  
  fundo.onerror = function() {
    console.error("❌ Erro ao carregar fundo:", urlFundo);
    
    // Desenha um fundo simples
    ctxFrente.fillStyle = "#4a6fa5";
    ctxFrente.fillRect(0, 0, canvasFrente.width, canvasFrente.height);
    
    ctxFrente.fillStyle = "#fff";
    ctxFrente.font = "bold 30px Arial";
    ctxFrente.fillText("CARTEIRINHA ESTUDANTIL", 180, 100);
    
    // Área da foto
    ctxFrente.fillStyle = "#fff";
    ctxFrente.fillRect(120, 140, 170, 200);
    ctxFrente.fillStyle = "#ccc";
    ctxFrente.fillRect(125, 145, 160, 190);
    
    // Carrega foto mesmo sem fundo
    foto.onload = function() {
      ctxFrente.drawImage(foto, 125, 145, 160, 190);
    };
    
    foto.onerror = function() {
      ctxFrente.fillStyle = "#999";
      ctxFrente.fillRect(125, 145, 160, 190);
      ctxFrente.fillStyle = "#666";
      ctxFrente.font = "16px Arial";
      ctxFrente.fillText("FOTO", 180, 240);
    };
    
    foto.src = urlFoto;
    
    desenharTextos(aluno);
  };
  
  fundo.src = urlFundo;
}

/* ==========================
   VERSO
========================== */
function desenharVerso() {
  const fundo = new Image();
  const urlFundo = CONFIG.caminhoImagens + "modelo-verso.png";
  
  console.log("Carregando verso:", urlFundo);
  
  fundo.onload = function() {
    console.log("✅ Verso carregado com sucesso!");
    ctxVerso.drawImage(fundo, 0, 0, canvasVerso.width, canvasVerso.height);
  };
  
  fundo.onerror = function() {
    console.error("❌ Erro ao carregar verso:", urlFundo);
    ctxVerso.fillStyle = "#2c3e50";
    ctxVerso.fillRect(0, 0, canvasVerso.width, canvasVerso.height);
    
    ctxVerso.fillStyle = "#fff";
    ctxVerso.font = "bold 28px Arial";
    ctxVerso.fillText("VERSO DA CARTEIRINHA", 220, 150);
    
    ctxVerso.font = "18px Arial";
    ctxVerso.fillText("Instituição: Educacional", 100, 220);
    ctxVerso.fillText("Validade: 12/12/2026", 100, 260);
    ctxVerso.fillText("Documento oficial", 100, 300);
  };
  
  fundo.src = urlFundo;
}

// Teste automático das URLs
console.log("=== TESTE DE URLs ===");
console.log("1. Frente:", CONFIG.caminhoImagens + "modelo-frente.png");
console.log("2. Verso:", CONFIG.caminhoImagens + "modelo-verso.png");
console.log("3. Foto 0001:", CONFIG.caminhoFotos + "0001.jpg");
console.log("4. Foto 0002:", CONFIG.caminhoFotos + "0002.jpg");

// Teste rápido de carregamento
const testImage = new Image();
testImage.onload = function() {
  console.log("✅ Teste: A pasta Imagens/ existe e é acessível");
};
testImage.onerror = function() {
  console.error("❌ Teste: Não foi possível acessar Imagens/");
  console.log("Verifique se o nome da pasta está correto: 'Imagens' com I maiúsculo");
};
testImage.src = CONFIG.caminhoImagens + "modelo-frente.png";
</script>

</body>
</html>
